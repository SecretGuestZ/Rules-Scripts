# ==========================================
# 混合定制版: MihomoPro (底层) + Mihomo Party (分组/规则)
# 适配客户端: ClashMac / Mihomo Party / 其它 Mihomo 内核客户端
# 2026/01/23
# ==========================================

# 1. 基础设置 (基于 Pro 版优化)
mode: rule
mixed-port: 7893
ipv6: false                 # macOS 环境下建议关闭以减少网络抖动
allow-lan: false            # 已按要求关闭，提升本机安全性
unified-delay: true
tcp-concurrent: true        # M3 芯片并行处理能力强，建议开启
log-level: warning
find-process-mode: 'always' # 精准识别 macOS 应用进程
global-client-fingerprint: chrome
# 针对 M3 芯片优化：允许 GSO 硬件加速以降低 CPU 占用
experimental:
  quic-go-disable-gso: false
  
# 2. 流量嗅探 (Pro 版核心: 解决域名分流不准的问题)
sniffer:
  enable: true
  sniff:
    HTTP: {ports: [80, 8080-8880], override-destination: true}
    TLS: {ports: [443, 8443]}
    QUIC: {ports: [443, 8443]}
  skip-domain:
    - '+.apple.com'          # 排除 Apple 服务防止推送异常
    - 'Mijia Cloud'

# 3. DNS 设置 (Pro 版核心: 极致秒开体验)
dns:
  enable: true
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query

# 4. TUN 模式设置 (适合 Mac 全局代理)
tun:
  enable: true
  stack: system             # macOS Tahoe 建议使用系统协议栈
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true   # 自动适应 MacBook 切换 WiFi

# 5. 节点提供者 (请在此处粘贴你的机场订阅链接)
proxy-providers:
  我的机场:
    type: http
    url: "你的订阅链接" # <--- 修改这里
    interval: 3600
    path: ./proxies/airport.yaml
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300

# 6. 分流分组 (完全采用 Party 版写法)
proxy-groups:
  - {name: 手动切换,  type: select, include-all: true, icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Static.png}
  - {name: 哔哩哔哩,  type: select, proxies: [DIRECT, 香港节点, 台湾节点], icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Bili.png}
  - {name: ChatGPT,  type: select, proxies: [手动切换, 自动选择, 香港节点, 日本节点, 台湾节点, 美国节点, 新加坡节点, 韩国节点, 加拿大节点, 英国节点], icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/OpenAI.png}
  - {name: Gemini,   type: select, proxies: [手动切换, 自动选择, 香港节点, 日本节点, 台湾节点, 美国节点, 新加坡节点, 韩国节点, 加拿大节点, 英国节点], icon: https://raw.githubusercontent.com/SecretGuestZ/Rules-Scripts/main/Resource/Icons/gemini.png}
  - {name: Claude,   type: select, proxies: [手动切换, 自动选择, 香港节点, 日本节点, 台湾节点, 美国节点, 新加坡节点, 韩国节点, 加拿大节点, 英国节点], icon: https://raw.githubusercontent.com/SecretGuestZ/Rules-Scripts/main/Resource/Icons/claude.png}
  - {name: Google,   type: select, proxies: [手动切换, 自动选择, 香港节点, 日本节点, 台湾节点, 美国节点, 新加坡节点, 韩国节点, 加拿大节点, 英国节点], icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Google.png}
  - {name: YouTube,  type: select, proxies: [手动切换, 自动选择, 香港节点, 日本节点, 台湾节点, 美国节点, 新加坡节点, 韩国节点, 加拿大节点, 英国节点], icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/YouTube.png}
  - {name: Bing,     type: select, proxies: [手动切换, 自动选择, 香港节点, 日本节点, 台湾节点, 美国节点, 新加坡节点, 韩国节点, 加拿大节点, 英国节点], icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Bing.png}
  - {name: Copilot,  type: select, proxies: [手动切换, 自动选择, 香港节点, 日本节点, 台湾节点, 美国节点, 新加坡节点, 韩国节点, 加拿大节点, 英国节点], icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Copilot.png}
  - {name: X,        type: select, proxies: [手动切换, 自动选择, 香港节点, 日本节点, 台湾节点, 美国节点, 新加坡节点, 韩国节点, 加拿大节点, 英国节点], icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/X.png}
  - {name: Telegram, type: select, proxies: [手动切换, 自动选择, 香港节点, 日本节点, 台湾节点, 美国节点, 新加坡节点, 韩国节点, 加拿大节点, 英国节点], icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Telegram.png}
  - {name: Github,   type: select, proxies: [手动切换, 自动选择, 香港节点, 日本节点, 台湾节点, 美国节点, 新加坡节点, 韩国节点, 加拿大节点, 英国节点], icon: https://raw.githubusercontent.com/Orz-3/mini/master/Alpha/github.png}
  - {name: Facebook, type: select, proxies: [手动切换, 自动选择, 香港节点, 日本节点, 台湾节点, 美国节点, 新加坡节点, 韩国节点, 加拿大节点, 英国节点], icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Facebook.png}
  - {name: 全球加速,  type: select, proxies: [手动切换, 自动选择, 香港节点, 日本节点, 台湾节点, 美国节点, 新加坡节点, 韩国节点, 加拿大节点, 英国节点], icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Global.png}
  - {name: 兜底分流,  type: select, proxies: [手动切换, 自动选择, 香港节点, 日本节点, 台湾节点, 美国节点, 新加坡节点, 韩国节点, 加拿大节点, 英国节点], icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Final.png}

  # 节点子分组 (自动正则筛选)
  - {name: 自动选择,   type: url-test, include-all: true, interval: 900, tolerance: 30, icon: https://raw.githubusercontent.com/Orz-3/mini/master/Color/Urltest.png}
  - {name: 香港节点,   type: url-test, include-all: true, interval: 900, tolerance: 30, filter: "港|HK|(?i)Hong", icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png}
  - {name: 日本节点,   type: url-test, include-all: true, interval: 900, tolerance: 30, filter: "日|东京|JP|(?i)Japan", icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png}
  - {name: 台湾节点,   type: url-test, include-all: true, interval: 900, tolerance: 30, filter: "台|湾|TW|(?i)Taiwan", icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png}
  - {name: 美国节点,   type: url-test, include-all: true, interval: 900, tolerance: 30, filter: "美|US|(?i)States|America", icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png}
  - {name: 新加坡节点, type: url-test, include-all: true, interval: 900, tolerance: 30, filter: "新|坡|SG|(?i)Singapore", icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png}
  - {name: 韩国节点,   type: url-test, include-all: true, interval: 900, tolerance: 30, filter: "韩|KR|(?i)Korea", icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Korea.png}
  - {name: 加拿大节点, type: url-test, include-all: true, interval: 900, tolerance: 30, filter: "加|拿大|CA|(?i)Canada", icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Canada.png}
  - {name: 英国节点,   type: url-test, include-all: true, interval: 900, tolerance: 30, filter: "英|GB|(?i)England|Britain", icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_Kingdom.png}

# 7. 分流规则源 (完全采用 Party 版写法)
rule-providers:
  Direct: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Direct/Direct.yaml", path: ./ruleset/Direct.yaml}
  AdBlock: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main/Filters/AWAvenue-Ads-Rule-Clash-Classical.yaml", path: ./ruleset/AdBlock.yaml}
  BiliBili: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/BiliBili/BiliBili.yaml", path: ./ruleset/BiliBili.yaml}
  ChatGPT: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.yaml", path: ./ruleset/ChatGPT.yaml}
  Gemini: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Gemini/Gemini.yaml", path: ./ruleset/Gemini.yaml}
  Claude: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/classical/anthropic.yaml", path: ./ruleset/Claude.yaml}
  Google: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google.yaml", path: ./ruleset/Google.yaml}
  YouTube: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml", path: ./ruleset/YouTube.yaml}
  Bing: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Bing/Bing.yaml", path: ./ruleset/Bing.yaml}
  Copilot: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Copilot/Copilot.yaml", path: ./ruleset/Copilot.yaml}
  X: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Twitter/Twitter.yaml", path: ./ruleset/X.yaml}
  Telegram: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Telegram/Telegram.yaml", path: ./ruleset/Telegram.yaml}
  Github: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GitHub/GitHub.yaml", path: ./ruleset/Github.yaml}
  Facebook: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Facebook/Facebook.yaml", path: ./ruleset/Facebook.yaml}
  ProxyLite: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ProxyLite/ProxyLite.yaml", path: ./ruleset/ProxyLite.yaml}
  Lan: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan.yaml", path: ./ruleset/Lan.yaml}
  China: {behavior: classical, interval: 86400, format: yaml, type: http, url: "https://raw.githubusercontent.com/VirgilClyne/GetSomeFries/main/ruleset/ASN.China.yaml", path: ./ruleset/ASN.China.yaml}

# 8. 最终匹配规则 (完全采用 Party 版写法)
rules:
  - RULE-SET,Direct, DIRECT
  - RULE-SET,AdBlock, REJECT
  # 2. 核心优化：阻止海外 QUIC 流量以强制退回更稳定的 TCP
  - AND,((DST-PORT,443),(NETWORK,UDP),(NOT,((GEOIP,CN)))),REJECT
  - RULE-SET,BiliBili, 哔哩哔哩
  - RULE-SET,ChatGPT, ChatGPT
  - RULE-SET,Gemini, Gemini
  - RULE-SET,Claude, Claude
  - RULE-SET,Google, Google
  - RULE-SET,YouTube, YouTube
  - RULE-SET,Bing, Bing
  - RULE-SET,Copilot, Copilot
  - RULE-SET,X, X
  - RULE-SET,Telegram, Telegram
  - RULE-SET,Github, Github
  - RULE-SET,Facebook, Facebook
  - RULE-SET,ProxyLite, 全球加速
  - RULE-SET,Lan, DIRECT
  - RULE-SET,China, DIRECT
  - GEOIP,CN, DIRECT
  - MATCH, 兜底分流
